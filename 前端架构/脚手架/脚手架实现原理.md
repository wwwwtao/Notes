## 脚手架实现原理

### NPM 命令执行原理

npm 脚本的原理非常简单。每当执行npm run，就会自动新建一个 Shell，在这个 Shell 里面执行指定的脚本命令。因此，只要是 Shell（一般是 Bash）可以运行的命令，就可以写在 npm 脚本里面。
比较特别的是，**npm run新建的这个 Shell，会将当前目录的node_modules/.bin子目录加入PATH变量**，执行结束后，再将PATH变量恢复原样。
这意味着，**当前目录的node_modules/.bin子目录里面的所有脚本，都可以直接用脚本名调用**，而不必加上路径。比如，当前项目的依赖里面有umi，只要直接写umi dev就可以了。
```js
"start": "umi dev"
而不用写成下面这样。
"start": "./node_modules/.bin/umi dev"
```
由于 npm 脚本的唯一要求就是可以在 Shell 执行，因此它不一定是 Node 脚本，任何可执行文件都可以写在里面。
npm 脚本的退出码，也遵守 Shell 脚本规则。如果退出码不是0，npm 就认为这个脚本执行失败。

### 为什么全局安装@vue/cli后添加的命令为vue

1. 原因：
因为vue/cli里面的package.json里面的配置了
```js
"bin": {
  "vue": "bin/vue.js" // vue是软链接的名称
}
```
在node下创建软链接（vue）指向@vue/cli/bin/vue.js

### 全局安装 @vue/cli 时发生了什么

1. 把依赖下载到指定的 lib/node_modules 下面
2. 配置bin的软链接（在lib/node_modules/@vue/cli/package.json里面找bin并配置到node的bin里面）

### 执行vue命令时发生了什么？为什么vue指向一个js文件，我们却可以通过vue命令执行它 

1. js文件需要通过一个解释器（node）来执行
2. vue.js 里面第一行写了 **#!/usr/bin/env node** 这行代码告诉了系统直接调用这个文件的时候去环境变量中找node命令 找到后通过node命令去执行